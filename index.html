<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã‡oklu Platform E-Ticaret YÃ¶netim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Koyu Gri Arkaplan */
            color: #d1d5db; /* AÃ§Ä±k Gri YazÄ± Rengi */
        }
        .sidebar {
            background-color: #1f2937; /* Daha AÃ§Ä±k Koyu Gri */
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.75rem;
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            color: #9ca3af;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #374151;
            color: #ffffff;
        }
        .nav-link i {
            width: 1.25rem;
            margin-right: 0.75rem;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .form-input, .form-textarea, .form-range, .form-select {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: #d1d5db;
            border-radius: 0.5rem;
            padding: 0.75rem;
            width: 100%;
        }
        .form-input:focus, .form-textarea:focus, .form-range:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px #4f46e560;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #4f46e5;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #photo-canvas-container {
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            position: relative;
        }
        #photo-canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
            border-radius: 0.5rem;
        }
        #image-previews .preview-wrapper {
            position: relative;
        }
        #image-previews img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .analysis-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-top: 0.5rem;
        }
        .analysis-content li {
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="relative min-h-screen lg:flex">
        <!-- Kenar Ã‡ubuÄŸu (Sidebar) -->
        <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 z-30 w-64 p-6 flex-shrink-0 flex flex-col justify-between transform -translate-x-full lg:translate-x-0 lg:relative lg:inset-auto lg:z-auto transition-transform duration-300 ease-in-out">
            <div>
                <div class="flex items-center gap-3 mb-10">
                    <i class="fas fa-rocket text-2xl text-indigo-400"></i>
                    <h1 class="text-xl font-bold text-white" data-translate-key="panel_title">SatÄ±cÄ± Paneli</h1>
                </div>
                <nav class="flex flex-col gap-3" id="nav-menu">
                    <a href="#dashboard" class="nav-link active">
                        <i class="fas fa-home"></i>
                        <span data-translate-key="nav_dashboard">Anasayfa</span>
                    </a>
                     <a href="#store-analyzer" class="nav-link">
                        <i class="fas fa-magnifying-glass-chart"></i>
                        <span data-translate-key="nav_store_analyzer">MaÄŸaza Analizcisi</span>
                    </a>
                    <a href="#listing-manager" class="nav-link">
                        <i class="fas fa-upload"></i>
                        <span data-translate-key="nav_listing_manager">Listeleme YÃ¶neticisi</span>
                    </a>
                    <a href="#ai-generator" class="nav-link">
                        <i class="fas fa-magic-wand-sparkles"></i>
                        <span data-translate-key="nav_ai_generator">AI Ä°Ã§erik Ãœretici</span>
                    </a>
                    <a href="#photo-editor" class="nav-link">
                        <i class="fas fa-camera-retro"></i>
                        <span data-translate-key="nav_photo_editor">FotoÄŸraf DÃ¼zenleyici</span>
                    </a>
                    <a href="#pricing-calculator" class="nav-link">
                        <i class="fas fa-calculator"></i>
                        <span data-translate-key="nav_pricing_calculator">Fiyat HesaplayÄ±cÄ±</span>
                    </a>
                     <a href="#platform-connections" class="nav-link">
                        <i class="fas fa-store"></i>
                        <span data-translate-key="nav_platform_connections">MaÄŸaza BaÄŸlantÄ±larÄ±</span>
                    </a>
                </nav>
            </div>
            <div>
                 <!-- Ayarlar ve Dil SeÃ§ici -->
                <div id="settings-selector" class="relative mb-4">
                    <div id="settings-dropdown" class="absolute bottom-full mb-2 w-full bg-[#1f2937] border border-[#374151] rounded-lg p-2 hidden">
                        <h4 class="text-xs font-bold text-gray-400 px-2 pb-2" data-translate-key="settings_language">Dil</h4>
                        <div class="flex flex-col gap-1">
                             <button onclick="setLanguage('tr')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡¹ðŸ‡· <span class="flex-1">TÃ¼rkÃ§e</span></button>
                             <button onclick="setLanguage('en')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡¬ðŸ‡§ <span class="flex-1">English</span></button>
                             <button onclick="setLanguage('de')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡©ðŸ‡ª <span class="flex-1">Deutsch</span></button>
                             <button onclick="setLanguage('fr')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡«ðŸ‡· <span class="flex-1">FranÃ§ais</span></button>
                             <button onclick="setLanguage('es')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡ªðŸ‡¸ <span class="flex-1">EspaÃ±ol</span></button>
                             <button onclick="setLanguage('pt')" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">ðŸ‡µðŸ‡¹ <span class="flex-1">PortuguÃªs</span></button>
                        </div>
                         <hr class="border-gray-600 my-2">
                        <h4 class="text-xs font-bold text-gray-400 px-2 pb-2" data-translate-key="settings_api_key">API AnahtarÄ±</h4>
                        <button id="enter-api-key-btn" class="text-left text-sm w-full hover:bg-gray-700 p-2 rounded flex items-center gap-2">
                            <i class="fas fa-key"></i>
                            <span data-translate-key="settings_enter_api_key">API AnahtarÄ±nÄ± Gir</span>
                        </button>
                    </div>
                    <button id="settings-btn" class="w-full text-gray-400 hover:text-white flex items-center gap-3 p-3 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-cog text-lg"></i>
                        <span data-translate-key="nav_settings">Ayarlar</span>
                    </button>
                </div>
                <div class="card p-4 text-center">
                    <p class="text-sm text-gray-400 mb-2" data-translate-key="pro_promo_text">VerimliliÄŸinizi ArtÄ±rÄ±n</p>
                    <button class="btn-primary w-full text-sm" data-translate-key="pro_promo_button">PRO'ya YÃ¼kselt</button>
                </div>
            </div>
        </aside>

        <!-- Ana Ä°Ã§erik -->
        <div class="flex-1">
            <!-- Mobil Header -->
            <header class="lg:hidden sticky top-0 bg-[#111827] bg-opacity-80 backdrop-blur-sm z-20 flex items-center justify-between p-4 border-b border-[#374151]">
                <button id="hamburger-btn" class="text-2xl">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="flex items-center gap-2">
                    <i class="fas fa-rocket text-lg text-indigo-400"></i>
                    <h1 class="text-lg font-bold text-white" data-translate-key="panel_title">SatÄ±cÄ± Paneli</h1>
                </div>
            </header>
            <main class="p-4 sm:p-8 overflow-y-auto">
                <div id="page-content">
                    <!-- Sayfa iÃ§eriÄŸi buraya dinamik olarak yÃ¼klenecek -->
                </div>
            </main>
        </div>
        
        <!-- Overlay -->
        <div id="sidebar-overlay" class="lg:hidden fixed inset-0 bg-black opacity-50 z-20 hidden"></div>
    </div>


    <!-- Modallar -->
    <div id="api-key-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 p-4">
        <div class="card p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold text-white mb-2" data-translate-key="api_modal_title">Gemini API AnahtarÄ±nÄ± Girin</h2>
            <p class="text-gray-400 mb-6" data-translate-key="api_modal_subtitle">Ãœretken yapay zeka Ã¶zelliklerini kullanmak iÃ§in API anahtarÄ±nÄ±z gereklidir.</p>
            <input type="password" id="api-key-input" class="form-input" placeholder="API AnahtarÄ±nÄ±zÄ± buraya yapÄ±ÅŸtÄ±rÄ±n...">
            <div class="flex flex-col sm:flex-row gap-4 mt-4">
                <button id="cancel-api-key-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full transition-colors" data-translate-key="button_cancel">Ä°ptal</button>
                <button id="save-api-key-btn" class="btn-primary w-full" data-translate-key="button_save">Kaydet</button>
            </div>
            <p class="text-xs text-gray-500 mt-4 text-center">
                <span data-translate-key="api_modal_get_key_text">API AnahtarÄ±nÄ±z yok mu?</span>
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-400 hover:underline" data-translate-key="api_modal_get_key_link">Buradan alÄ±n.</a>
            </p>
        </div>
    </div>
    
    <div id="shopify-url-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 p-4">
        <div class="card p-8 max-w-md w-full">
            <i class="fab fa-shopify text-5xl text-green-500 mb-4 mx-auto"></i>
            <h2 class="text-2xl font-bold text-white mb-2" data-translate-key="shopify_modal_url_title">Shopify MaÄŸaza Adresinizi Girin</h2>
            <p class="text-gray-400 mb-6" data-translate-key="shopify_modal_url_subtitle">BaÄŸlanmak iÃ§in '.myshopify.com' adresinizi girin.</p>
            <input type="text" id="shopify-url-input" class="form-input text-center" placeholder="magazaniz.myshopify.com">
            <div class="flex flex-col sm:flex-row gap-4 mt-4">
                <button id="cancel-shopify-url-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full transition-colors" data-translate-key="button_cancel">Ä°ptal</button>
                <button id="continue-shopify-btn" class="btn-primary w-full" data-translate-key="button_continue">Devam Et</button>
            </div>
        </div>
    </div>

    <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 p-4">
        <div class="card p-8 max-w-sm w-full text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
            <h2 class="text-xl font-bold text-white mb-2" data-translate-key="delete_modal_title">Emin misiniz?</h2>
            <p class="text-gray-400 mb-6" data-translate-key="delete_modal_subtitle">Bu iÃ§erik kalÄ±cÄ± olarak silinecektir. Bu iÅŸlem geri alÄ±namaz.</p>
            <div class="flex gap-4">
                <button id="cancel-delete-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full transition-colors" data-translate-key="button_cancel">Ä°ptal</button>
                <button id="confirm-delete-btn" class="bg-red-700 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg w-full transition-colors" data-translate-key="button_confirm_delete">Evet, Sil</button>
            </div>
        </div>
    </div>


    <script>
        // --- CONFIGURATION ---
        const API_BASE_URL = 'https://satici-paneli.onrender.com'; 
        
        // --- DÄ°L VE Ã‡EVÄ°RÄ° YÃ–NETÄ°MÄ° ---

        const translations = {
            tr: {
                panel_title: "SatÄ±cÄ± Paneli",
                nav_dashboard: "Anasayfa",
                nav_store_analyzer: "MaÄŸaza Analizcisi",
                nav_listing_manager: "Listeleme YÃ¶neticisi",
                nav_ai_generator: "AI Ä°Ã§erik Ãœretici",
                nav_photo_editor: "FotoÄŸraf DÃ¼zenleyici",
                nav_pricing_calculator: "Fiyat HesaplayÄ±cÄ±",
                nav_platform_connections: "MaÄŸaza BaÄŸlantÄ±larÄ±",
                nav_settings: "Ayarlar",
                settings_language: "Dil",
                settings_api_key: "API AnahtarÄ±",
                settings_enter_api_key: "API AnahtarÄ±nÄ± Gir",
                api_modal_title: "Gemini API AnahtarÄ±nÄ± Girin",
                api_modal_subtitle: "Ãœretken yapay zeka Ã¶zelliklerini kullanmak iÃ§in API anahtarÄ±nÄ±z gereklidir.",
                api_modal_get_key_text: "API AnahtarÄ±nÄ±z yok mu?",
                api_modal_get_key_link: "Buradan alÄ±n.",
                pro_promo_text: "VerimliliÄŸinizi ArtÄ±rÄ±n",
                pro_promo_button: "PRO'ya YÃ¼kselt",
                dashboard_welcome_title: "SatÄ±cÄ± Paneline HoÅŸ Geldiniz!",
                dashboard_welcome_subtitle: "Ä°ÅŸ akÄ±ÅŸÄ±nÄ±zÄ± hÄ±zlandÄ±racak araÃ§lara buradan hÄ±zlÄ±ca eriÅŸebilirsiniz.",
                dashboard_ai_desc: "Yapay zeka ile saniyeler iÃ§inde Ã¼rÃ¼n iÃ§erikleri oluÅŸturun.",
                dashboard_photo_desc: "ÃœrÃ¼n fotoÄŸraflarÄ±nÄ±zÄ± kolayca dÃ¼zenleyin ve filigran ekleyin.",
                dashboard_pricing_desc: "Maliyetlerinizi girerek doÄŸru satÄ±ÅŸ fiyatÄ±nÄ± hesaplayÄ±n.",
                dashboard_connections_desc: "Etsy gibi pazar yerlerindeki maÄŸazalarÄ±nÄ±zÄ± baÄŸlayÄ±n.",
                analyzer_title: "MaÄŸaza Analizcisi",
                analyzer_subtitle: "MaÄŸaza URL'nizi girin, yapay zeka gÃ¼Ã§lÃ¼ ve zayÄ±f yÃ¶nlerinizi analiz etsin.",
                analyzer_placeholder: "https://www.etsy.com/shop/magazaniz...",
                analyzer_button: "MaÄŸazayÄ± Analiz Et",
                analyzer_loading: "Yapay zeka maÄŸazanÄ±zÄ± inceliyor...",
                analyzer_report_title: "Analiz Raporu",
                analyzer_overall: "Genel DeÄŸerlendirme",
                analyzer_seo: "SEO ve Anahtar Kelimeler",
                analyzer_visuals: "GÃ¶rsel Analizi",
                analyzer_recommendations: "Eyleme GeÃ§irilebilir Ã–neriler",
                analyzer_save_report: "Analizi Kaydet",
                analyzer_copy_report: "Raporu Kopyala",
                analyzer_saved_analyses: "KaydedilmiÅŸ Analizler",
                analyzer_no_saved_analyses: "HenÃ¼z kaydedilmiÅŸ bir analiz yok.",
                button_view: "GÃ¶rÃ¼ntÃ¼le",
                button_share: "PaylaÅŸ",
                listing_manager_title: "Listeleme YÃ¶neticisi",
                listing_manager_subtitle: "ÃœrÃ¼n bilgilerinizi burada toplayÄ±n ve maÄŸazanÄ±za yÃ¼kleyin.",
                listing_manager_select_content: "KaydedilmiÅŸ Ä°Ã§erik SeÃ§in",
                listing_manager_no_content_selected: "Ä°Ã§erik seÃ§ilmedi",
                listing_manager_price: "Fiyat (â‚º)",
                listing_manager_stock: "Stok Adedi",
                listing_manager_images: "ÃœrÃ¼n GÃ¶rselleri",
                listing_manager_upload_to: "YÃ¼klenecek MaÄŸaza",
                listing_manager_upload_button: "YÃ¼kle",
                listing_manager_uploading: "YÃ¼kleniyor...",
                listing_manager_uploaded: "BaÅŸarÄ±yla YÃ¼klendi!",
                ai_title: "Yapay Zeka Destekli Ä°Ã§erik Ãœretici",
                ai_subtitle: "ÃœrÃ¼nÃ¼nÃ¼zle ilgili anahtar kelimeleri girin, sizin iÃ§in baÅŸlÄ±k, aÃ§Ä±klama ve etiketleri oluÅŸturalÄ±m.",
                ai_keywords_label: "Anahtar Kelimeler",
                ai_keywords_placeholder_desc: "Ã–rn: el yapÄ±mÄ±, gÃ¼mÃ¼ÅŸ kolye, yonca figÃ¼rlÃ¼, kadÄ±n hediye",
                ai_keywords_placeholder_input: "ÃœrÃ¼nÃ¼nÃ¼zÃ¼ tanÄ±mlayan kelimeleri virgÃ¼lle ayÄ±rarak yazÄ±n...",
                ai_button_generate: "Ä°Ã§erik OluÅŸtur",
                ai_loader_text: "Yapay zeka sizin iÃ§in yazÄ±yor...",
                ai_translating_text: "Ã‡evriliyor...",
                ai_generated_title_label: "BaÅŸlÄ±k",
                ai_generated_desc_label: "AÃ§Ä±klama",
                ai_generated_tags_label: "Etiketler",
                ai_title_not_found: "BaÅŸlÄ±k bulunamadÄ±",
                ai_description_not_found: "AÃ§Ä±klama bulunamadÄ±",
                ai_tags_not_found: "Etiketler bulunamadÄ±",
                ai_button_save: "Bu Ä°Ã§eriÄŸi Kaydet",
                ai_button_translate: "Ä°ngilizce'ye Ã‡evir",
                ai_saved_content_title: "Kaydedilen Ä°Ã§erikler",
                ai_no_saved_content: "HenÃ¼z kaydedilmiÅŸ bir iÃ§erik yok.",
                button_save: "Kaydet",
                button_copy: "Kopyala",
                button_copied: "KopyalandÄ±!",
                button_delete: "Sil",
                photo_editor_title: "FotoÄŸraf DÃ¼zenleyici",
                photo_editor_subtitle: "ÃœrÃ¼n fotoÄŸraflarÄ±nÄ±zÄ± yÃ¼kleyin, dÃ¼zenleyin ve indirin.",
                photo_editor_upload_btn: "FotoÄŸraf YÃ¼kle",
                photo_editor_brightness: "ParlaklÄ±k",
                photo_editor_contrast: "Kontrast",
                photo_editor_saturation: "Doygunluk",
                photo_editor_watermark: "Filigran Metni",
                photo_editor_watermark_placeholder: "MaÄŸaza AdÄ±nÄ±z",
                photo_editor_apply_watermark: "Filigran Uygula",
                photo_editor_reset: "SÄ±fÄ±rla",
                photo_editor_download: "Ä°ndir",
                photo_editor_placeholder: "DÃ¼zenlemek iÃ§in bir fotoÄŸraf yÃ¼kleyin.",
                pricing_title: "AkÄ±llÄ± Fiyat HesaplayÄ±cÄ±",
                pricing_subtitle: "Maliyetlerinizi girin, kÃ¢rlÄ± ve rekabetÃ§i satÄ±ÅŸ fiyatÄ±nÄ±zÄ± anÄ±nda hesaplayÄ±n.",
                pricing_cost: "ÃœrÃ¼n Maliyeti (â‚º)",
                pricing_margin: "Ä°stenen KÃ¢r MarjÄ± (%)",
                pricing_shipping: "Kargo Ãœcreti (â‚º)",
                pricing_fee: "Platform Komisyonu (%)",
                pricing_button_calculate: "Hesapla",
                pricing_result_title: "Ã–nerilen SatÄ±ÅŸ FiyatÄ±:",
                pricing_result_profit_text: "Bu fiyattan size kalacak net kÃ¢r:",
                connections_title: "MaÄŸaza BaÄŸlantÄ±larÄ±",
                connections_subtitle: "SatÄ±ÅŸ yaptÄ±ÄŸÄ±nÄ±z platformlardaki maÄŸazalarÄ±nÄ±zÄ± buraya baÄŸlayarak yÃ¶netmeye baÅŸlayÄ±n.",
                connections_etsy_desc: "El yapÄ±mÄ± ve vintage Ã¼rÃ¼nler iÃ§in pazar yeri.",
                connections_shopify_desc: "Kendi e-ticaret sitenizi oluÅŸturun ve yÃ¶netin.",
                connections_amazon_desc: "Amazon'un el yapÄ±mÄ± Ã¼rÃ¼nler iÃ§in Ã¶zel bÃ¶lÃ¼mÃ¼.",
                button_connect: "BaÄŸlan",
                button_continue: "Devam Et",
                button_connected: "BaÄŸlantÄ± Kuruldu",
                button_soon: "Ã‡ok YakÄ±nda",
                shopify_modal_url_title: "Shopify MaÄŸaza Adresinizi Girin",
                shopify_modal_url_subtitle: "BaÄŸlanmak iÃ§in '.myshopify.com' adresinizi girin.",
                shopify_modal_perm1: "ÃœrÃ¼nlerinizi okuma ve yazma",
                delete_modal_title: "Emin misiniz?",
                delete_modal_subtitle: "Bu iÃ§erik kalÄ±cÄ± olarak silinecektir. Bu iÅŸlem geri alÄ±namaz.",
                button_cancel: "Ä°ptal",
                button_confirm_delete: "Evet, Sil",
                lang_name: "TÃ¼rkÃ§e",
                ai_prompt: `Bir e-ticaret metin yazarÄ± olarak davran. AÅŸaÄŸÄ±daki anahtar kelimeleri kullanarak SEO uyumlu, satÄ±ÅŸ odaklÄ± ve yaratÄ±cÄ± Ã¼rÃ¼n iÃ§erikleri oluÅŸtur. Anahtar Kelimeler: "{keywords}"\n\nÃ‡Ä±ktÄ±yÄ± mutlaka ÅŸu formatta ver:\nBaÅŸlÄ±k: [OluÅŸturulan BaÅŸlÄ±k]\nAÃ§Ä±klama: [OluÅŸturulan AÃ§Ä±klama]\nEtiketler: [OluÅŸturulan Etiketler]`,
                ai_translate_prompt: `AÅŸaÄŸÄ±daki e-ticaret iÃ§eriÄŸini profesyonel ve akÄ±cÄ± bir ÅŸekilde Ä°ngilizce'ye Ã§evir. Pazarlama dilini koru. Ã‡Ä±ktÄ±yÄ± mutlaka ÅŸu formatta ver:\nBaÅŸlÄ±k: [Ã‡evrilmiÅŸ BaÅŸlÄ±k]\nAÃ§Ä±klama: [Ã‡evrilmiÅŸ AÃ§Ä±klama]\nEtiketler: [Ã‡evrilmiÅŸ Etiketler]\n\n---Ä°Ã‡ERÄ°K---\nBaÅŸlÄ±k: {title}\nAÃ§Ä±klama: {description}\nEtiketler: {tags}`,
                ai_analyzer_prompt: `Sen bir e-ticaret danÄ±ÅŸmanÄ± uzmanÄ±sÄ±n. GÃ¶revin, verilen URL'deki online maÄŸazayÄ± analiz etmek ve satÄ±cÄ±ya maÄŸazasÄ±nÄ± geliÅŸtirmesi iÃ§in eyleme geÃ§irilebilir Ã¶neriler sunmak. Analizini ÅŸu baÅŸlÄ±klara ayÄ±rarak Markdown formatÄ±nda sun:\n\n### Genel DeÄŸerlendirme\n(MaÄŸazanÄ±n ilk izlenimi, marka kimliÄŸi, gÃ¼venilirlik ve genel profesyonelliÄŸi hakkÄ±nda kÄ±sa bir Ã¶zet.)\n\n### SEO ve Anahtar Kelimeler\n(ÃœrÃ¼n baÅŸlÄ±klarÄ±nÄ±n, aÃ§Ä±klamalarÄ±nÄ±n ve etiketlerinin (varsa) arama motorlarÄ± iÃ§in ne kadar optimize edildiÄŸini deÄŸerlendir. GÃ¼Ã§lÃ¼ ve zayÄ±f yÃ¶nleri belirt.)\n\n### GÃ¶rsel Analizi\n(ÃœrÃ¼n fotoÄŸraflarÄ±nÄ±n kalitesini, tutarlÄ±lÄ±ÄŸÄ±nÄ±, aydÄ±nlatmasÄ±nÄ± ve mÃ¼ÅŸteriyi ne kadar cezbettiÄŸini analiz et.)\n\n### Eyleme GeÃ§irilebilir Ã–neriler\n(YukarÄ±daki analizlere dayanarak, satÄ±cÄ±nÄ±n satÄ±ÅŸlarÄ±nÄ± artÄ±rmak iÃ§in atabileceÄŸi 3-5 adet somut, Ã¶ncelikli ve uygulanabilir adÄ±mÄ± madde madde listele.)\n\nAnaliz edilecek maÄŸaza: `
            },
            en: {
                // ... English translations
            },
            // Other languages omitted for brevity
        };
        
        // --- SCRIPT START ---
        
        // Add a comma to the pt object
        translations.de = {...translations.en, ...translations.de};
        translations.fr = {...translations.en, ...translations.fr};
        translations.es = {...translations.en, ...translations.es};
        translations.pt = {...translations.en, ...translations.pt};


        let currentLang = localStorage.getItem('language') || 'tr';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang;
            
            document.querySelectorAll('#settings-dropdown button[onclick^="setLanguage"]').forEach(button => {
                const buttonLang = button.getAttribute('onclick').match(/'([^']+)'/)[1];
                button.classList.toggle('bg-indigo-600', buttonLang === lang);
                button.classList.toggle('text-white', buttonLang === lang);
            });

            translatePage();
            document.getElementById('settings-dropdown')?.classList.add('hidden');
        }

        function translatePage() {
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if (translations[currentLang] && translations[currentLang][key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        if(el.placeholder) el.placeholder = translations[currentLang][key];
                    } else {
                        el.innerText = translations[currentLang][key];
                    }
                }
            });
            const currentPage = window.location.hash.substring(1) || 'dashboard';
            loadPage(true);
        }


        // --- TEMEL UYGULAMA YÃ–NLENDÄ°RME (ROUTING) VE KONTROL ---

        const pageContent = document.getElementById('page-content');
        const navLinks = document.querySelectorAll('.nav-link');
        let lastAnalysisResult = { url: '', markdownText: '' };

        const pages = {
            dashboard: `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="dashboard_welcome_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="dashboard_welcome_subtitle"></p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <a href="#store-analyzer" class="card p-6 hover:bg-gray-700 transition-colors block">
                        <div class="flex items-center gap-4">
                            <i class="fas fa-magnifying-glass-chart text-3xl text-amber-400"></i>
                            <div>
                                <h3 class="font-bold text-white" data-translate-key="nav_store_analyzer"></h3>
                                <p class="text-sm text-gray-400">MaÄŸazanÄ±zÄ±n gÃ¼Ã§lÃ¼ ve zayÄ±f yÃ¶nlerini keÅŸfedin.</p>
                            </div>
                        </div>
                    </a>
                    <a href="#listing-manager" class="card p-6 hover:bg-gray-700 transition-colors block">
                        <div class="flex items-center gap-4">
                            <i class="fas fa-upload text-3xl text-green-400"></i>
                            <div>
                                <h3 class="font-bold text-white" data-translate-key="nav_listing_manager"></h3>
                                <p class="text-sm text-gray-400" data-translate-key="dashboard_connections_desc"></p>
                            </div>
                        </div>
                    </a>
                    <a href="#ai-generator" class="card p-6 hover:bg-gray-700 transition-colors block">
                        <div class="flex items-center gap-4">
                            <i class="fas fa-magic-wand-sparkles text-3xl text-indigo-400"></i>
                            <div>
                                <h3 class="font-bold text-white" data-translate-key="nav_ai_generator"></h3>
                                <p class="text-sm text-gray-400" data-translate-key="dashboard_ai_desc"></p>
                            </div>
                        </div>
                    </a>
                    <a href="#photo-editor" class="card p-6 hover:bg-gray-700 transition-colors block">
                        <div class="flex items-center gap-4">
                            <i class="fas fa-camera-retro text-3xl text-sky-400"></i>
                            <div>
                                <h3 class="font-bold text-white" data-translate-key="nav_photo_editor"></h3>
                                <p class="text-sm text-gray-400" data-translate-key="dashboard_photo_desc"></p>
                            </div>
                        </div>
                    </a>
                    <a href="#pricing-calculator" class="card p-6 hover:bg-gray-700 transition-colors block">
                        <div class="flex items-center gap-4">
                            <i class="fas fa-calculator text-3xl text-emerald-400"></i>
                            <div>
                                <h3 class="font-bold text-white" data-translate-key="nav_pricing_calculator"></h3>
                                <p class="text-sm text-gray-400" data-translate-key="dashboard_pricing_desc"></p>
                            </div>
                        </div>
                    </a>
                </div>
            `,
            'store-analyzer': `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="analyzer_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="analyzer_subtitle"></p>
                <div class="card p-6 sm:p-8 max-w-4xl mx-auto">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="store-url-input" class="form-input flex-1" data-translate-key="analyzer_placeholder">
                        <button id="analyze-store-btn" class="btn-primary flex-shrink-0">
                            <i class="fas fa-magnifying-glass-chart mr-2"></i>
                            <span data-translate-key="analyzer_button"></span>
                        </button>
                    </div>
                </div>

                <div id="analysis-results-container" class="mt-8 max-w-4xl mx-auto hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                         <h3 class="text-2xl font-bold text-white" data-translate-key="analyzer_report_title"></h3>
                         <div class="flex gap-2 mt-4 sm:mt-0">
                            <button id="save-analysis-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-3 rounded-lg text-sm flex items-center gap-1.5">
                                <i class="fas fa-save"></i> <span data-translate-key="analyzer_save_report"></span>
                            </button>
                             <button id="share-analysis-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg text-sm flex items-center gap-1.5">
                                <i class="fab fa-whatsapp"></i> <span data-translate-key="button_share"></span>
                            </button>
                            <button id="copy-analysis-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-3 rounded-lg text-sm flex items-center gap-1.5">
                                <i class="fas fa-copy"></i> <span data-translate-key="analyzer_copy_report"></span>
                            </button>
                         </div>
                    </div>
                     <div class="space-y-6">
                        <div class="card p-6">
                            <h4 class="font-bold text-lg text-white" data-translate-key="analyzer_overall"></h4>
                            <div id="analysis-overall" class="mt-2 text-gray-300 analysis-content"></div>
                        </div>
                         <div class="card p-6">
                            <h4 class="font-bold text-lg text-white" data-translate-key="analyzer_seo"></h4>
                            <div id="analysis-seo" class="mt-2 text-gray-300 analysis-content"></div>
                        </div>
                         <div class="card p-6">
                            <h4 class="font-bold text-lg text-white" data-translate-key="analyzer_visuals"></h4>
                            <div id="analysis-visuals" class="mt-2 text-gray-300 analysis-content"></div>
                        </div>
                         <div class="card p-6 border-l-4 border-indigo-500">
                            <h4 class="font-bold text-lg text-white" data-translate-key="analyzer_recommendations"></h4>
                            <div id="analysis-recommendations" class="mt-2 text-gray-300 analysis-content"></div>
                        </div>
                     </div>
                </div>
                 <div id="analyzer-loader" class="mt-8 text-center hidden">
                    <div class="spinner mx-auto"></div>
                    <p class="mt-4 text-gray-400" data-translate-key="analyzer_loading"></p>
                </div>

                <div class="mt-12 max-w-4xl mx-auto">
                    <h3 class="text-2xl font-bold text-white mb-4" data-translate-key="analyzer_saved_analyses"></h3>
                    <div id="saved-analyses-area">
                        <p id="no-saved-analyses" class="text-gray-500" data-translate-key="analyzer_no_saved_analyses"></p>
                        <div id="saved-analyses-list" class="flex flex-col gap-4"></div>
                    </div>
                </div>
            `,
            'listing-manager': `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="listing_manager_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="listing_manager_subtitle"></p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Sol SÃ¼tun: Bilgiler -->
                    <div class="lg:col-span-2 card p-6 sm:p-8 space-y-6">
                        <div>
                            <label for="saved-content-selector" class="block font-medium mb-2 text-gray-300" data-translate-key="listing_manager_select_content"></label>
                            <select id="saved-content-selector" class="form-select"></select>
                        </div>
                        <div>
                            <label for="listing-title" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_title_label"></label>
                            <input type="text" id="listing-title" class="form-input">
                        </div>
                        <div>
                            <label for="listing-description" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_desc_label"></label>
                            <textarea id="listing-description" class="form-textarea h-40"></textarea>
                        </div>
                        <div>
                            <label for="listing-tags" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_tags_label"></label>
                            <input type="text" id="listing-tags" class="form-input">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="listing-price" class="block font-medium mb-2 text-gray-300" data-translate-key="listing_manager_price"></label>
                                <input type="number" id="listing-price" class="form-input" placeholder="99.90">
                            </div>
                            <div>
                                <label for="listing-stock" class="block font-medium mb-2 text-gray-300" data-translate-key="listing_manager_stock"></label>
                                <input type="number" id="listing-stock" class="form-input" placeholder="10">
                            </div>
                        </div>
                    </div>
                    <!-- SaÄŸ SÃ¼tun: YÃ¼kleme ve GÃ¶rseller -->
                    <div class="lg:col-span-1 space-y-6">
                        <div class="card p-6">
                            <h3 class="font-bold text-white" data-translate-key="listing_manager_images"></h3>
                            <div id="image-previews" class="mt-4 grid grid-cols-3 gap-2 min-h-[100px] bg-gray-800 rounded-lg p-2"></div>
                            <label for="image-upload-manager" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full flex items-center justify-center gap-2 mt-4 cursor-pointer">
                                <i class="fas fa-images"></i> <span data-translate-key="photo_editor_upload_btn"></span>
                           </label>
                           <input type="file" id="image-upload-manager" class="hidden" accept="image/*" multiple>
                        </div>
                        <div class="card p-6">
                            <h3 class="font-bold text-white" data-translate-key="listing_manager_upload_to"></h3>
                            <select id="store-selector" class="form-select mt-4"></select>
                            <button id="upload-to-platform-btn" class="btn-primary w-full mt-4 flex items-center justify-center gap-2">
                                 <span data-translate-key="listing_manager_upload_button"></span>
                            </button>
                        </div>
                    </div>
                </div>
            `,
            'ai-generator': `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="ai_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="ai_subtitle"></p>
                <div class="card p-8 max-w-7xl mx-auto">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <label for="ai-keywords" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_keywords_label"></label>
                            <p class="text-sm text-gray-500 mb-2" data-translate-key="ai_keywords_placeholder_desc"></p>
                            <textarea id="ai-keywords" class="form-textarea h-32" data-translate-key="ai_keywords_placeholder_input"></textarea>
                            <button id="generate-btn" class="btn-primary mt-4 w-full flex items-center justify-center gap-2">
                                <i class="fas fa-magic-wand-sparkles"></i>
                                <span data-translate-key="ai_button_generate"></span>
                            </button>
                        </div>
                        <div id="ai-output-container" class="relative">
                            <div id="ai-loader" class="absolute inset-0 bg-gray-800 bg-opacity-70 flex-col items-center justify-center rounded-lg hidden">
                                <div class="spinner"></div>
                                <p id="loader-text" class="mt-4 text-gray-300" data-translate-key="ai_loader_text"></p>
                            </div>
                            <div class="flex flex-col gap-4">
                                <div>
                                    <label for="ai-title" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_title_label"></label>
                                    <input type="text" id="ai-title" class="form-input">
                                </div>
                                <div>
                                    <label for="ai-description" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_desc_label"></label>
                                    <textarea id="ai-description" class="form-textarea h-48"></textarea>
                                </div>
                                <div>
                                    <label for="ai-tags" class="block font-medium mb-2 text-gray-300" data-translate-key="ai_generated_tags_label"></label>
                                    <input type="text" id="ai-tags" class="form-input">
                                </div>
                                <div class="flex flex-col sm:flex-row gap-2 mt-2">
                                    <button id="save-content-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg w-full flex items-center justify-center gap-2">
                                        <i class="fas fa-save"></i>
                                        <span data-translate-key="ai_button_save"></span>
                                    </button>
                                    <button id="translate-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg w-full flex items-center justify-center gap-2">
                                        <i class="fas fa-language"></i>
                                        <span data-translate-key="ai_button_translate"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-12 max-w-7xl mx-auto">
                    <h3 class="text-2xl font-bold text-white mb-4" data-translate-key="ai_saved_content_title"></h3>
                    <div id="saved-content-area">
                        <p id="no-saved-content" class="text-gray-500" data-translate-key="ai_no_saved_content"></p>
                        <div id="saved-content-list" class="flex flex-col gap-4"></div>
                    </div>
                </div>
            `,
            'photo-editor': `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="photo_editor_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="photo_editor_subtitle"></p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 card p-6 flex flex-col gap-6">
                        <div>
                           <label for="image-upload" class="btn-primary w-full text-center cursor-pointer">
                                <i class="fas fa-upload mr-2"></i> <span data-translate-key="photo_editor_upload_btn"></span>
                           </label>
                           <input type="file" id="image-upload" class="hidden" accept="image/*">
                        </div>
                        <div id="editor-controls" class="hidden flex-col gap-4">
                             <div>
                                <label for="brightness" class="block font-medium mb-2 text-sm" data-translate-key="photo_editor_brightness"></label>
                                <input type="range" id="brightness" min="0" max="200" value="100" class="w-full">
                            </div>
                            <div>
                                <label for="contrast" class="block font-medium mb-2 text-sm" data-translate-key="photo_editor_contrast"></label>
                                <input type="range" id="contrast" min="0" max="200" value="100" class="w-full">
                            </div>
                            <div>
                                <label for="saturate" class="block font-medium mb-2 text-sm" data-translate-key="photo_editor_saturation"></label>
                                <input type="range" id="saturate" min="0" max="200" value="100" class="w-full">
                            </div>
                            <hr class="border-gray-600">
                             <div>
                                <label for="watermark-text" class="block font-medium mb-2 text-sm" data-translate-key="photo_editor_watermark"></label>
                                <input type="text" id="watermark-text" class="form-input text-sm" data-translate-key="photo_editor_watermark_placeholder">
                                <button id="apply-watermark-btn" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-3 rounded-lg text-sm mt-2" data-translate-key="photo_editor_apply_watermark"></button>
                            </div>
                            <hr class="border-gray-600">
                            <div class="flex gap-2">
                                <button id="reset-btn" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-3 rounded-lg text-sm" data-translate-key="photo_editor_reset"></button>
                                <button id="download-btn" class="w-full btn-primary py-2 px-3 text-sm" data-translate-key="photo_editor_download"></button>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-2 card p-4 flex items-center justify-center">
                        <div id="photo-canvas-container" class="bg-gray-800 rounded-lg flex items-center justify-center">
                            <p id="canvas-placeholder" class="text-gray-500" data-translate-key="photo_editor_placeholder"></p>
                            <canvas id="photo-canvas"></canvas>
                        </div>
                    </div>
                </div>
            `,
            'pricing-calculator': `
                <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="pricing_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="pricing_subtitle"></p>
                <div class="card p-8 max-w-2xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="product-cost" class="block font-medium mb-2 text-gray-300" data-translate-key="pricing_cost"></label>
                            <input type="number" id="product-cost" class="form-input" placeholder="100">
                        </div>
                        <div>
                            <label for="profit-margin" class="block font-medium mb-2 text-gray-300" data-translate-key="pricing_margin"></label>
                            <input type="number" id="profit-margin" class="form-input" placeholder="50">
                        </div>
                        <div>
                            <label for="shipping-cost" class="block font-medium mb-2 text-gray-300" data-translate-key="pricing_shipping"></label>
                            <input type="number" id="shipping-cost" class="form-input" placeholder="60">
                        </div>
                        <div>
                            <label for="platform-fee" class="block font-medium mb-2 text-gray-300" data-translate-key="pricing_fee"></label>
                            <input type="number" id="platform-fee" class="form-input" placeholder="15">
                        </div>
                    </div>
                    <button id="calculate-price-btn" class="btn-primary mt-6 w-full" data-translate-key="pricing_button_calculate"></button>
                    <div id="price-result" class="mt-8 text-center hidden">
                        <p class="text-gray-400" data-translate-key="pricing_result_title"></p>
                        <p class="text-4xl font-bold text-green-400 mt-2" id="final-price"></p>
                        <p class="text-sm text-gray-500 mt-2" id="price-breakdown"></p>
                    </div>
                </div>
            `,
            'platform-connections': `
                 <h2 class="text-3xl font-bold text-white mb-2" data-translate-key="connections_title"></h2>
                <p class="text-gray-400 mb-8" data-translate-key="connections_subtitle"></p>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div id="etsy-card" class="card p-6 flex flex-col items-center text-center">
                        <i class="fab fa-etsy text-5xl text-orange-500 mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Etsy</h3>
                        <p class="text-sm text-gray-400 mb-4 h-10" data-translate-key="connections_etsy_desc"></p>
                        <button id="etsy-connect-btn" class="btn-primary w-full mt-auto flex items-center justify-center gap-2">
                            <i class="fas fa-link"></i>
                            <span data-translate-key="button_connect"></span>
                        </button>
                    </div>
                    <div class="card p-6 flex flex-col items-center text-center">
                        <i class="fab fa-shopify text-5xl text-green-500 mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Shopify</h3>
                        <p class="text-sm text-gray-400 mb-4 h-10" data-translate-key="connections_shopify_desc"></p>
                        <button id="shopify-connect-btn" class="btn-primary w-full mt-auto flex items-center justify-center gap-2">
                           <i class="fas fa-link"></i>
                           <span data-translate-key="button_connect"></span>
                        </button>
                    </div>
                    <div class="card p-6 flex flex-col items-center text-center">
                        <i class="fab fa-amazon text-5xl text-yellow-500 mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Amazon Handmade</h3>
                        <p class="text-sm text-gray-400 mb-4 h-10" data-translate-key="connections_amazon_desc"></p>
                        <button class="btn-primary w-full mt-auto bg-gray-500 cursor-not-allowed" disabled data-translate-key="button_soon"></button>
                    </div>
                 </div>
            `
        };

        // --- Ä°Ã‡ERÄ°K KAYDETME/YÃ–NETME FONKSÄ°YONLARI ---

        function getSavedContent() { return JSON.parse(localStorage.getItem('savedAIContent')) || []; }
        function setSavedContent(content) { localStorage.setItem('savedAIContent', JSON.stringify(content)); }

        function deleteContent(id) {
            let content = getSavedContent().filter(item => item.id !== id);
            setSavedContent(content);
            renderSavedContent();
        }

        function copyContent(id) {
            const content = getSavedContent().find(item => item.id === id);
            if (!content) return;

            const textToCopy = `Title: ${content.title}\n\nDescription: ${content.description}\n\nTags: ${content.tags}`;
            const textArea = document.createElement("textarea");
            textArea.style.position = 'fixed';
            textArea.style.top = '-9999px';
            textArea.style.left = '-9999px';
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();

            try {
                document.execCommand('copy');
                const copyBtn = document.querySelector(`button[data-copy-id='${id}']`);
                if (copyBtn) {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = `<i class="fas fa-check"></i> <span data-translate-key="button_copied">${translations[currentLang].button_copied}</span>`;
                    setTimeout(() => { copyBtn.innerHTML = originalText; }, 2000);
                }
            } catch (err) {
                console.error('Kopyalama baÅŸarÄ±sÄ±z oldu', err);
            } finally {
                document.body.removeChild(textArea);
            }
        }

        function renderSavedContent() {
            const content = getSavedContent();
            const listContainer = document.getElementById('saved-content-list');
            const noContentMessage = document.getElementById('no-saved-content');
            if (!listContainer || !noContentMessage) return;
            listContainer.innerHTML = '';
            if (content.length === 0) {
                noContentMessage.style.display = 'block';
            } else {
                noContentMessage.style.display = 'none';
                content.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'card p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4';
                    itemElement.innerHTML = `
                        <div class="flex-1 overflow-hidden">
                            <h4 class="font-bold text-white truncate">${item.title}</h4>
                            <p class="text-sm text-gray-400 mt-1 truncate">${item.description}</p>
                        </div>
                        <div class="flex-shrink-0 flex gap-2">
                            <button data-copy-id="${item.id}" class="bg-gray-600 hover:bg-gray-500 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fas fa-copy"></i> <span data-translate-key="button_copy">${translations[currentLang].button_copy}</span>
                            </button>
                            <button data-delete-id="${item.id}" class="bg-red-700 hover:bg-red-600 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fas fa-trash"></i> <span data-translate-key="button_delete">${translations[currentLang].button_delete}</span>
                            </button>
                        </div>
                    `;
                    listContainer.appendChild(itemElement);
                });
            }
        }

        function saveCurrentContent() {
            const title = document.getElementById('ai-title').value;
            const description = document.getElementById('ai-description').value;
            const tags = document.getElementById('ai-tags').value;
            const saveBtn = document.getElementById('save-content-btn');
            if (!title.trim() || title.includes("bulunamadÄ±") || title.includes("not found")) {
                saveBtn.classList.add('bg-red-600');
                saveBtn.querySelector('span').innerText = "Kaydedilecek iÃ§erik yok";
                setTimeout(() => {
                    saveBtn.classList.remove('bg-red-600');
                    saveBtn.querySelector('span').innerText = translations[currentLang].ai_button_save;
                }, 2500);
                return;
            }
            const newItem = { id: Date.now(), title, description, tags };
            let content = getSavedContent();
            content.unshift(newItem);
            setSavedContent(content);
            renderSavedContent();
            saveBtn.classList.add('bg-green-600');
            saveBtn.querySelector('span').innerText = "BaÅŸarÄ±yla Kaydedildi!";
            setTimeout(() => {
                saveBtn.classList.remove('bg-green-600');
                saveBtn.querySelector('span').innerText = translations[currentLang].ai_button_save;
            }, 2500);
        }

        function loadPage(isJustRefreshing = false) {
            const hash = window.location.hash.substring(1).split('?')[0] || 'dashboard';
            if (pages[hash]) {
                pageContent.innerHTML = pages[hash];
                if (!isJustRefreshing) {
                    updateActiveLink(hash);
                }
                addPageSpecificListeners(hash);
                document.querySelectorAll('#page-content [data-translate-key]').forEach(el => {
                    const key = el.dataset.translateKey;
                     if (translations[currentLang] && translations[currentLang][key]) {
                        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.tagName === 'SELECT') {
                           if(el.placeholder !== undefined) el.placeholder = translations[currentLang][key];
                        } else {
                            el.innerText = translations[currentLang][key];
                        }
                    }
                });

            }
        }

        function updateActiveLink(hash) {
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === `#${hash}`);
            });
        }
        
        function addPageSpecificListeners(page) {
            if (page === 'listing-manager') {
                initializeListingManager();
            } else if (page === 'store-analyzer') {
                document.getElementById('analyze-store-btn').addEventListener('click', analyzeStore);
                document.getElementById('save-analysis-btn').addEventListener('click', saveCurrentAnalysis);
                document.getElementById('copy-analysis-btn').addEventListener('click', copyCurrentAnalysis);
                document.getElementById('share-analysis-btn').addEventListener('click', () => shareAnalysis(null));
                renderSavedAnalyses();
                document.getElementById('saved-analyses-area').addEventListener('click', e => {
                    const viewBtn = e.target.closest('button[data-view-id]');
                    const copyBtn = e.target.closest('button[data-copy-id]');
                    const deleteBtn = e.target.closest('button[data-delete-id]');
                    const shareBtn = e.target.closest('button[data-share-id]');

                    if (viewBtn) viewAnalysis(parseInt(viewBtn.dataset.viewId));
                    if (copyBtn) copyAnalysis(parseInt(copyBtn.dataset.copyId));
                    if (shareBtn) shareAnalysis(parseInt(shareBtn.dataset.shareId));
                    if (deleteBtn) showDeleteConfirmModal(parseInt(deleteBtn.dataset.deleteId), 'analysis');
                });
            } else if (page === 'ai-generator') {
                document.getElementById('generate-btn').addEventListener('click', generateAIContent);
                document.getElementById('save-content-btn').addEventListener('click', saveCurrentContent);
                document.getElementById('translate-btn').addEventListener('click', translateContentToEnglish);
                updateAiButtonStates();
                renderSavedContent();
                const savedContentArea = document.getElementById('saved-content-area');
                if (savedContentArea) {
                    savedContentArea.addEventListener('click', (e) => {
                        const copyBtn = e.target.closest('button[data-copy-id]');
                        const deleteBtn = e.target.closest('button[data-delete-id]');
                        if (copyBtn) { copyContent(parseInt(copyBtn.dataset.copyId)); }
                        if (deleteBtn) { showDeleteConfirmModal(parseInt(deleteBtn.dataset.deleteId), 'content'); }
                    });
                }
            } else if (page === 'pricing-calculator') {
                document.getElementById('calculate-price-btn').addEventListener('click', calculatePrice);
            } else if (page === 'platform-connections') {
                document.getElementById('shopify-connect-btn').addEventListener('click', showShopifyUrlModal);
                updateConnectionButtonStates(); 
            } else if (page === 'photo-editor') {
                initializePhotoEditor();
            }
        }

        document.getElementById('nav-menu').addEventListener('click', (e) => {
            const link = e.target.closest('a');
            if (link) {
                const hash = link.getAttribute('href').substring(1);
                updateActiveLink(hash);
                 // Mobil menÃ¼yÃ¼ kapat
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        });

        window.addEventListener('hashchange', () => loadPage());
        document.addEventListener('DOMContentLoaded', () => {
             // DiÄŸer diller iÃ§in Ã§evirileri buraya ekleyin
            translations.es = {...translations.en, ...translations.es};
            translations.fr = {...translations.en, ...translations.fr};
            translations.de = {...translations.en, ...translations.de};
            translations.pt = {...translations.en, ...translations.pt};

             setLanguage(currentLang);
             loadPage();
             checkForAuthRedirect();
        });
        
        function checkForAuthRedirect() {
            const hashParams = new URLSearchParams(window.location.hash.split('?')[1]);
            
            if (hashParams.get('connected') === 'shopify') {
                const shop = hashParams.get('shop');
                if (shop) {
                    let connections = getConnections();
                    connections.shopify = shop; // Store the shop name
                    localStorage.setItem('connectedStores', JSON.stringify(connections));
                }
                
                // Clean the URL
                const newUrl = window.location.pathname + "#platform-connections";
                history.replaceState(null, '', newUrl);

                // Update UI
                loadPage(true); // SayfayÄ± yeniden yÃ¼kleyerek buton durumunu gÃ¼ncelleyin
            }
        }

        // --- MOBÄ°L MENÃœ KONTROLÃœ ---
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const hamburgerBtn = document.getElementById('hamburger-btn');
        hamburgerBtn.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        });
        overlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // --- MODAL FONKSÄ°YONLARI ---
        const deleteModal = document.getElementById('delete-confirm-modal');
        const apiKeyModal = document.getElementById('api-key-modal');
        let itemToDeleteId = null;
        let itemTypeToDelete = null;

        function showDeleteConfirmModal(id, type) { 
            itemToDeleteId = id; 
            itemTypeToDelete = type;
            deleteModal.classList.remove('hidden'); 
        }
        function hideDeleteConfirmModal() { 
            itemToDeleteId = null; 
            itemTypeToDelete = null;
            deleteModal.classList.add('hidden'); 
        }
        function showApiKeyModal() { 
            document.getElementById('api-key-input').value = getApiKey();
            apiKeyModal.classList.remove('hidden'); 
        }
        function hideApiKeyModal() { apiKeyModal.classList.add('hidden'); }
        
        const shopifyUrlModal = document.getElementById('shopify-url-modal');
        function showShopifyUrlModal() { shopifyUrlModal.classList.remove('hidden'); }
        function hideShopifyUrlModal() { shopifyUrlModal.classList.add('hidden'); }
        
        document.getElementById('continue-shopify-btn')?.addEventListener('click', () => {
            const urlInput = document.getElementById('shopify-url-input');
            const shopName = urlInput.value.trim().replace('.myshopify.com', '');
            if (shopName) {
                window.location.href = `${API_BASE_URL}/shopify/auth?shop=${shopName}.myshopify.com`;
            }
        });

        document.getElementById('cancel-shopify-url-btn')?.addEventListener('click', hideShopifyUrlModal);

        document.getElementById('confirm-delete-btn')?.addEventListener('click', () => {
            if (itemToDeleteId !== null) { 
                if (itemTypeToDelete === 'content') deleteContent(itemToDeleteId);
                if (itemTypeToDelete === 'analysis') deleteAnalysis(itemToDeleteId);
            }
            hideDeleteConfirmModal();
        });
        document.getElementById('cancel-delete-btn')?.addEventListener('click', hideDeleteConfirmModal);
        document.getElementById('save-api-key-btn')?.addEventListener('click', saveApiKey);
        document.getElementById('cancel-api-key-btn')?.addEventListener('click', hideApiKeyModal);

        // --- AYARLAR MENÃœSÃœ KONTROLÃœ ---
        document.body.addEventListener('click', function(event) {
            const settingsBtn = document.getElementById('settings-btn');
            const settingsDropdown = document.getElementById('settings-dropdown');
            const enterApiKeyBtn = document.getElementById('enter-api-key-btn');

            if (settingsBtn && settingsBtn.contains(event.target)) {
                settingsDropdown.classList.toggle('hidden');
            } else if(enterApiKeyBtn && enterApiKeyBtn.contains(event.target)) {
                showApiKeyModal();
                settingsDropdown.classList.add('hidden');
            } else if (settingsDropdown && !settingsDropdown.classList.contains('hidden') && !settingsDropdown.contains(event.target) && !settingsBtn.contains(event.target)) {
                settingsDropdown.classList.add('hidden');
            }
        });
        
        // --- API ANAHTARI & BAÄžLANTI YÃ–NETÄ°MÄ° ---
        function getApiKey() { return localStorage.getItem('geminiApiKey') || ''; }

        function saveApiKey() {
            const apiKeyInput = document.getElementById('api-key-input');
            const key = apiKeyInput.value.trim();
            localStorage.setItem('geminiApiKey', key);
            hideApiKeyModal();
            if ((window.location.hash.substring(1) || 'dashboard') === 'ai-generator') {
                updateAiButtonStates();
            }
        }
        
        function getConnections() {
            try {
                const connections = JSON.parse(localStorage.getItem('connectedStores'));
                return connections || { shopify: false };
            } catch (e) {
                console.error("Could not parse connected stores from localStorage", e);
                return { shopify: false };
            }
        }

        function updateConnectionButtonStates() {
            const connections = getConnections();
            const shopifyBtn = document.getElementById('shopify-connect-btn');
            
            if (connections.shopify && shopifyBtn) {
                shopifyBtn.classList.remove('btn-primary');
                shopifyBtn.classList.add('bg-green-600', 'cursor-default');
                shopifyBtn.querySelector('span').setAttribute('data-translate-key', 'button_connected');
                shopifyBtn.querySelector('span').innerText = translations[currentLang].button_connected;
                shopifyBtn.disabled = true;
            }
        }

        function updateAiButtonStates() {
            const generateBtn = document.getElementById('generate-btn');
            const translateBtn = document.getElementById('translate-btn');
            if (!generateBtn || !translateBtn) return;
            if (!getApiKey()) {
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                translateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                translateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // --- YAPAY ZEKA FONKSÄ°YONLARI ---
        async function callGeminiAPI(prompt, isGrounded = false) {
            const apiKey = getApiKey();
            if (!apiKey) {
                showApiKeyModal();
                return null;
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            if(isGrounded) {
                payload.tools = [{ "google_search": {} }];
            }
            
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    let errorDetail = `API error: ${response.status}`;
                    try { errorDetail = (await response.json()).error?.message || errorDetail; } catch (e) {}
                    throw new Error(errorDetail);
                }
                const result = await response.json();
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (generatedText) {
                    return generatedText;
                } else {
                   throw new Error("Invalid response from API.");
                }
            } catch (error) {
                console.error("Gemini API Error:", error);
                alert(`API HatasÄ±: ${error.message}`);
                return null;
            }
        }

        async function generateAIContent() {
            const keywords = document.getElementById('ai-keywords').value;
            if (!keywords.trim()) { return; }
            if (!getApiKey()) { return showApiKeyModal(); }

            const loader = document.getElementById('ai-loader');
            const loaderText = document.getElementById('loader-text');
            const generateBtn = document.getElementById('generate-btn');
            
            loaderText.innerText = translations[currentLang].ai_loader_text;
            loader.style.display = 'flex';
            generateBtn.disabled = true;

            const promptTemplate = translations[currentLang].ai_prompt;
            const combinedPrompt = promptTemplate.replace('{keywords}', keywords);
            
            const generatedText = await callGeminiAPI(combinedPrompt);
            if(generatedText) {
                parseAndDisplayAIResult(generatedText);
            }

            loader.style.display = 'none';
            generateBtn.disabled = false;
        }

        async function translateContentToEnglish() {
            const title = document.getElementById('ai-title').value;
            const description = document.getElementById('ai-description').value;
            const tags = document.getElementById('ai-tags').value;

            if (!title.trim() && !description.trim() && !tags.trim()) { return; }
             if (!getApiKey()) { return showApiKeyModal(); }

            const loader = document.getElementById('ai-loader');
            const loaderText = document.getElementById('loader-text');
            const translateBtn = document.getElementById('translate-btn');
            
            loaderText.innerText = translations[currentLang].ai_translating_text;
            loader.style.display = 'flex';
            translateBtn.disabled = true;

            let promptTemplate = translations[currentLang].ai_translate_prompt || translations['en'].ai_translate_prompt;
            const combinedPrompt = promptTemplate
                .replace('{title}', title)
                .replace('{description}', description)
                .replace('{tags}', tags);

            const generatedText = await callGeminiAPI(combinedPrompt);
            if(generatedText) {
                parseAndDisplayAIResult(generatedText);
            }
            
            loader.style.display = 'none';
            translateBtn.disabled = false;
        }
        
        function parseAndDisplayAIResult(text) {
            const getSection = (key) => {
                const regex = new RegExp(`(?:${key}):([\\s\\S]*?)(?=(?:Title|BaÅŸlÄ±k|Titel|Titre|TÃ­tulo|Description|AÃ§Ä±klama|Beschreibung|DescripciÃ³n|Tags|Etiketler|Ã‰tiquettes|Etiquetas):|$)`, "i");
                const match = text.match(regex);
                return match ? match[1].trim() : null;
            };

            const title = getSection("Title|BaÅŸlÄ±k|Titel|Titre|TÃ­tulo");
            const description = getSection("Description|AÃ§Ä±klama|Beschreibung|DescripciÃ³n");
            const tags = getSection("Tags|Etiketler|Ã‰tiquettes|Etiquetas");

            const titleNotFound = translations[currentLang]?.ai_title_not_found ?? "Title not found.";
            const descNotFound = translations[currentLang]?.ai_description_not_found ?? "Description not found.";
            const tagsNotFound = translations[currentLang]?.ai_tags_not_found ?? "Tags not found.";

            document.getElementById('ai-title').value = title || titleNotFound;
            document.getElementById('ai-description').value = description || descNotFound;
            document.getElementById('ai-tags').value = tags || tagsNotFound;
        }
        
        // --- MAÄžAZA ANALÄ°ZCÄ°SÄ° FONKSÄ°YONLARI ---
        function getSavedAnalyses() { return JSON.parse(localStorage.getItem('savedAnalyses')) || []; }
        function setSavedAnalyses(analyses) { localStorage.setItem('savedAnalyses', JSON.stringify(analyses)); }

        function saveCurrentAnalysis() {
            const saveBtn = document.getElementById('save-analysis-btn');
            if (!lastAnalysisResult.url) { return; }
            
            let analyses = getSavedAnalyses();
            if (!analyses.some(a => a.id === lastAnalysisResult.id)) {
                analyses.unshift(lastAnalysisResult);
                setSavedAnalyses(analyses);
            }
            
            renderSavedAnalyses();

            saveBtn.classList.add('bg-green-600');
            saveBtn.querySelector('span').innerText = translations[currentLang].button_copied;
            setTimeout(() => {
                saveBtn.classList.remove('bg-green-600');
                saveBtn.querySelector('span').innerText = translations[currentLang].analyzer_save_report;
            }, 2500);
        }

        function copyCurrentAnalysis() {
            const copyBtn = document.getElementById('copy-analysis-btn');
            if (!lastAnalysisResult.markdownText) return;
            const textToCopy = lastAnalysisResult.markdownText;
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyBtn.querySelector('span').innerText = translations[currentLang].button_copied;
                setTimeout(() => {
                    copyBtn.querySelector('span').innerText = translations[currentLang].analyzer_copy_report;
                }, 2000);
            } catch (err) { console.error('Copy failed', err); }
            document.body.removeChild(textArea);
        }
        
        function renderSavedAnalyses() {
            const analyses = getSavedAnalyses();
            const listContainer = document.getElementById('saved-analyses-list');
            const noAnalysesMessage = document.getElementById('no-saved-analyses');
            if (!listContainer || !noAnalysesMessage) return;
            listContainer.innerHTML = '';
            if (analyses.length === 0) {
                noAnalysesMessage.style.display = 'block';
            } else {
                noAnalysesMessage.style.display = 'none';
                analyses.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'card p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4';
                    itemElement.innerHTML = `
                        <div class="flex-1 overflow-hidden">
                            <p class="text-sm text-gray-400">${new Date(item.id).toLocaleDateString()}</p>
                            <h4 class="font-bold text-white truncate">${item.url}</h4>
                        </div>
                        <div class="flex-shrink-0 flex flex-wrap gap-2">
                             <button data-view-id="${item.id}" class="bg-sky-600 hover:bg-sky-500 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fas fa-eye"></i> <span data-translate-key="button_view">${translations[currentLang].button_view}</span>
                            </button>
                            <button data-share-id="${item.id}" class="bg-green-600 hover:bg-green-500 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fab fa-whatsapp"></i> <span data-translate-key="button_share">${translations[currentLang].button_share}</span>
                            </button>
                            <button data-copy-id="${item.id}" class="bg-gray-600 hover:bg-gray-500 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fas fa-copy"></i> <span data-translate-key="button_copy">${translations[currentLang].button_copy}</span>
                            </button>
                            <button data-delete-id="${item.id}" class="bg-red-700 hover:bg-red-600 text-white text-xs font-bold py-2 px-3 rounded-lg flex items-center gap-1.5 transition-colors">
                                <i class="fas fa-trash"></i> <span data-translate-key="button_delete">${translations[currentLang].button_delete}</span>
                            </button>
                        </div>
                    `;
                    listContainer.appendChild(itemElement);
                });
            }
        }
        
        function viewAnalysis(id) {
            const analyses = getSavedAnalyses();
            const analysis = analyses.find(a => a.id === id);
            if (analysis) {
                document.getElementById('store-url-input').value = analysis.url;
                renderAnalysisResult(analysis.markdownText);
                document.getElementById('analysis-results-container').classList.remove('hidden');
                window.scrollTo(0, 0);
            }
        }

        function copyAnalysis(id) {
            const analysis = getSavedAnalyses().find(item => item.id === id);
            if (!analysis) return;
            const textToCopy = analysis.markdownText;
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const copyBtn = document.querySelector(`#saved-analyses-list button[data-copy-id='${id}']`);
                if (copyBtn) {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = `<i class="fas fa-check"></i> <span data-translate-key="button_copied">${translations[currentLang].button_copied}</span>`;
                    setTimeout(() => { copyBtn.innerHTML = originalText; }, 2000);
                }
            } catch (err) { console.error('Copy failed', err); }
            document.body.removeChild(textArea);
        }

        function shareAnalysis(id) {
            const analyses = getSavedAnalyses();
            const analysis = id ? analyses.find(a => a.id === id) : lastAnalysisResult;

            if (!analysis || !analysis.markdownText) return;

            // Format the text for sharing (simplified markdown for chat apps)
            const formattedText = analysis.markdownText
                .replace(/###\s*(.*?)\n/g, '*$1*\n') // Bold headings
                .replace(/\*\s/g, 'â€¢ '); // Replace markdown bullets with a simple bullet

            const shareData = {
                title: `${translations[currentLang].analyzer_report_title}: ${analysis.url}`,
                text: formattedText,
            };

            if (navigator.share) {
                navigator.share(shareData).catch(console.error);
            } else {
                // Fallback for desktop: copy
                const shareBtn = id 
                    ? document.querySelector(`#saved-analyses-list button[data-share-id='${id}']`)
                    : document.getElementById('share-analysis-btn');
                    
                const textToCopy = `${shareData.title}\n\n${shareData.text}`;
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    if (shareBtn) {
                        const originalText = shareBtn.innerHTML;
                        shareBtn.innerHTML = `<i class="fas fa-check"></i> <span data-translate-key="button_copied">${translations[currentLang].button_copied}</span>`;
                        setTimeout(() => { shareBtn.innerHTML = originalText; }, 2000);
                    }
                } catch (err) {
                    console.error('Fallback copy failed', err);
                }
                document.body.removeChild(textArea);
            }
        }

        function deleteAnalysis(id) {
            let analyses = getSavedAnalyses();
            analyses = analyses.filter(item => item.id !== id);
            setSavedAnalyses(analyses);
            renderSavedAnalyses();
        }

        async function analyzeStore() {
            const urlInput = document.getElementById('store-url-input');
            const url = urlInput.value.trim();
            if (!url) { return; }
            if (!getApiKey()) { return showApiKeyModal(); }

            const loader = document.getElementById('analyzer-loader');
            const resultsContainer = document.getElementById('analysis-results-container');
            const analyzeBtn = document.getElementById('analyze-store-btn');
            
            resultsContainer.classList.add('hidden');
            loader.style.display = 'block';
            analyzeBtn.disabled = true;

            const promptTemplate = translations[currentLang].ai_analyzer_prompt;
            const fullPrompt = promptTemplate + url;
            
            const analysisText = await callGeminiAPI(fullPrompt, true); // Grounded call

            if (analysisText) {
                lastAnalysisResult = { url: url, markdownText: analysisText, id: Date.now() }; // Store result
                renderAnalysisResult(analysisText);
                resultsContainer.classList.remove('hidden');
            }

            loader.style.display = 'none';
            analyzeBtn.disabled = false;
        }

        function renderAnalysisResult(markdownText) {
            const getSection = (key) => {
                 const regex = new RegExp(`###\\s*${key}([\\s\\S]*?)(?=###|$)`, "i");
                 const match = markdownText.match(regex);
                 return match ? match[1].trim() : "";
            };

            const sections = {
                'analyzer_overall': 'analysis-overall',
                'analyzer_seo': 'analysis-seo',
                'analyzer_visuals': 'analysis-visuals',
                'analyzer_recommendations': 'analysis-recommendations'
            };

            for (const [key, elementId] of Object.entries(sections)) {
                const content = getSection(translations[currentLang][key]);
                const element = document.getElementById(elementId);
                if (element) {
                    // Simple markdown to HTML
                    element.innerHTML = content
                        .replace(/^\s*\*\s*(.*)/gm, '<ul><li>$1</li></ul>') // bullets
                        .replace(/<\/ul>\s*<ul>/g, ''); // merge lists
                }
            }
        }


        // --- FOTOÄžRAF DÃœZENLEYÄ°CÄ° FONKSÄ°YONLARI ---
        let originalImage = null;
        function initializePhotoEditor() {
            const uploadInput = document.getElementById('image-upload');
            const controls = document.getElementById('editor-controls');
            const canvas = document.getElementById('photo-canvas');
            const placeholder = document.getElementById('canvas-placeholder');
            const ctx = canvas.getContext('2d');
            const brightnessSlider = document.getElementById('brightness');
            const contrastSlider = document.getElementById('contrast');
            const saturateSlider = document.getElementById('saturate');
            const watermarkInput = document.getElementById('watermark-text');
            const applyWatermarkBtn = document.getElementById('apply-watermark-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');

            function applyFiltersAndWatermark() {
                if (!originalImage) return;
                ctx.filter = `brightness(${brightnessSlider.value}%) contrast(${contrastSlider.value}%) saturate(${saturateSlider.value}%)`;
                ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
                const watermarkText = watermarkInput.value;
                if (watermarkText.trim() !== '') {
                    ctx.filter = 'none';
                    const fontSize = canvas.width / 20;
                    ctx.font = `bold ${fontSize}px Arial`;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    ctx.fillText(watermarkText, canvas.width - 20, canvas.height - 20);
                }
            }
            
            uploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        
                        placeholder.style.display = 'none';
                        controls.style.display = 'flex';
                        resetFilters();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });

            function resetFilters() {
                brightnessSlider.value = 100;
                contrastSlider.value = 100;
                saturateSlider.value = 100;
                watermarkInput.value = '';
                applyFiltersAndWatermark();
            }

            [brightnessSlider, contrastSlider, saturateSlider, applyWatermarkBtn, resetBtn].forEach(el => {
                el.addEventListener('click', applyFiltersAndWatermark);
                 if(el.type === 'range') el.addEventListener('input', applyFiltersAndWatermark);
            });
            resetBtn.addEventListener('click', resetFilters);
            downloadBtn.addEventListener('click', () => {
                if (!originalImage) return;
                const link = document.createElement('a');
                link.download = 'edited-photo.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            });
        }
        
        // --- LÄ°STELEME YÃ–NETÄ°CÄ°SÄ° FONKSÄ°YONLARI ---
        function initializeListingManager() {
            const selector = document.getElementById('saved-content-selector');
            const titleInput = document.getElementById('listing-title');
            const descInput = document.getElementById('listing-description');
            const tagsInput = document.getElementById('listing-tags');
            const imageUpload = document.getElementById('image-upload-manager');
            const previewsContainer = document.getElementById('image-previews');
            const uploadBtn = document.getElementById('upload-to-platform-btn');
            const storeSelector = document.getElementById('store-selector');

            let uploadedFiles = [];

            const renderPreviews = () => {
                previewsContainer.innerHTML = '';
                uploadedFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const previewWrapper = document.createElement('div');
                        previewWrapper.className = 'preview-wrapper';
                        
                        const img = document.createElement('img');
                        img.src = event.target.result;

                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs transition-colors';
                        deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                        deleteBtn.onclick = (e) => {
                            e.preventDefault();
                            uploadedFiles.splice(index, 1);
                            renderPreviews();
                        };
                        
                        previewWrapper.appendChild(img);
                        previewWrapper.appendChild(deleteBtn);
                        previewsContainer.appendChild(previewWrapper);
                    };
                    reader.readAsDataURL(file);
                });
            };

            imageUpload.addEventListener('change', (e) => {
                uploadedFiles.push(...Array.from(e.target.files));
                renderPreviews();
                e.target.value = ''; // Reset input so same file can be selected again
            });


            // Dropdown'u doldur
            const savedContent = getSavedContent();
            selector.innerHTML = `<option value="">${translations[currentLang].listing_manager_no_content_selected}</option>`;
            savedContent.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.title;
                selector.appendChild(option);
            });
            
            // Dropdown'dan seÃ§im yapÄ±lÄ±nca alanlarÄ± doldur
            selector.addEventListener('change', (e) => {
                const selectedId = parseInt(e.target.value);
                const selectedContent = savedContent.find(item => item.id === selectedId);
                if (selectedContent) {
                    titleInput.value = selectedContent.title;
                    descInput.value = selectedContent.description;
                    tagsInput.value = selectedContent.tags;
                } else {
                    titleInput.value = '';
                    descInput.value = '';
                    tagsInput.value = '';
                }
            });

            const connections = getConnections();
            storeSelector.innerHTML = '';
            
            if (connections.shopify) {
                 const option = document.createElement('option');
                option.value = `shopify:${connections.shopify}`;
                option.textContent = `Shopify: ${connections.shopify.replace('.myshopify.com', '')}`;
                storeSelector.appendChild(option);
            }

            // YÃ¼kleme simÃ¼lasyonu
            uploadBtn.addEventListener('click', async () => {
                 const platformAndShop = storeSelector.value;
                 if(!platformAndShop) {
                     alert("LÃ¼tfen bir maÄŸaza seÃ§in.");
                     return;
                 }
                 const [platform, shop] = platformAndShop.split(':');
                 
                const productData = {
                    shop: shop,
                    title: titleInput.value,
                    body_html: descInput.value,
                    tags: tagsInput.value,
                    price: document.getElementById('listing-price').value,
                    inventory_quantity: document.getElementById('listing-stock').value,
                };

                const originalText = uploadBtn.innerHTML;
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = `<div class="spinner !w-5 !h-5 !border-2"></div> <span data-translate-key="listing_manager_uploading">${translations[currentLang].listing_manager_uploading}</span>`;

                try {
                    const response = await fetch(`${API_BASE_URL}/${platform}/products`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productData)
                    });

                    if (!response.ok) {
                        const errorResult = await response.json();
                        throw new Error(errorResult.message || 'YÃ¼kleme baÅŸarÄ±sÄ±z oldu');
                    }

                    const result = await response.json();
                    console.log('YÃ¼kleme baÅŸarÄ±lÄ±:', result);

                    uploadBtn.classList.remove('btn-primary');
                    uploadBtn.classList.add('bg-green-600');
                    uploadBtn.innerHTML = `<i class="fas fa-check-circle"></i> <span data-translate-key="listing_manager_uploaded">${translations[currentLang].listing_manager_uploaded}</span>`;

                } catch (error) {
                    console.error('YÃ¼kleme hatasÄ±:', error);
                    alert(`Hata: ${error.message}`);
                    uploadBtn.classList.remove('btn-primary');
                    uploadBtn.classList.add('bg-red-600');
                    uploadBtn.innerHTML = `Hata OluÅŸtu`;
                } finally {
                     setTimeout(() => {
                        uploadBtn.disabled = false;
                        uploadBtn.classList.remove('bg-green-600', 'bg-red-600');
                        uploadBtn.classList.add('btn-primary');
                        uploadBtn.innerHTML = originalText;
                    }, 3000);
                }
            });
        }


        // --- FÄ°YAT HESAPLAYICI FONKSÄ°YONLARI ---
        function calculatePrice() {
            const cost = parseFloat(document.getElementById('product-cost').value) || 0;
            const margin = parseFloat(document.getElementById('profit-margin').value) || 0;
            const shipping = parseFloat(document.getElementById('shipping-cost').value) || 0;
            const fee = parseFloat(document.getElementById('platform-fee').value) || 0;
            if (cost === 0) { return; }
            const priceBeforeFee = cost * (1 + margin / 100);
            const finalPrice = (priceBeforeFee + shipping) / (1 - (fee / 100));
            const platformCut = finalPrice * (fee / 100);
            const netProfit = finalPrice - cost - shipping - platformCut;
            document.getElementById('final-price').textContent = finalPrice.toFixed(2);
            const breakdownEl = document.getElementById('price-breakdown');
            breakdownEl.innerHTML = `${translations[currentLang].pricing_result_profit_text} <strong class="text-green-400">${netProfit.toFixed(2)}</strong>`;
            document.getElementById('price-result').classList.remove('hidden');
        }

    </script>
</body>
</html>

